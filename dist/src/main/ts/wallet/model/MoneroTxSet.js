"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _assert = _interopRequireDefault(require("assert"));
var _GenUtils = _interopRequireDefault(require("../../common/GenUtils"));
var _MoneroTxWallet = _interopRequireDefault(require("./MoneroTxWallet"));
var _MoneroUtils = _interopRequireDefault(require("../../common/MoneroUtils"));

/**
 * Groups transactions who share common hex data which is needed in order to
 * sign and submit the transactions.
 * 
 * For example, multisig transactions created from createTxs() share a common
 * hex string which is needed in order to sign and submit the multisig
 * transactions.
 */
class MoneroTxSet {






  constructor(txSet) {
    Object.assign(this, txSet);

    // copy txs
    if (this.txs) {
      for (let i = 0; i < this.txs.length; i++) {
        this.txs[i] = new _MoneroTxWallet.default(this.txs[i]);
        this.txs[i].setTxSet(this);
      }
    }
  }

  toJson() {
    let json = Object.assign({}, this); // copy state
    if (this.getTxs() !== undefined) {
      json.txs = [];
      for (let tx of this.getTxs()) json.txs.push(tx.toJson());
    }
    return json;
  }

  getTxs() {
    return this.txs;
  }

  setTxs(txs) {
    this.txs = txs;
    return this;
  }

  getMultisigTxHex() {
    return this.multisigTxHex;
  }

  setMultisigTxHex(multisigTxHex) {
    this.multisigTxHex = multisigTxHex;
    return this;
  }

  getUnsignedTxHex() {
    return this.unsignedTxHex;
  }

  setUnsignedTxHex(unsignedTxHex) {
    this.unsignedTxHex = unsignedTxHex;
    return this;
  }

  getSignedTxHex() {
    return this.signedTxHex;
  }

  setSignedTxHex(signedTxHex) {
    this.signedTxHex = signedTxHex;
    return this;
  }

  merge(txSet) {
    (0, _assert.default)(txSet instanceof MoneroTxSet);
    if (this === txSet) return this;

    // merge sets
    this.setMultisigTxHex(_GenUtils.default.reconcile(this.getMultisigTxHex(), txSet.getMultisigTxHex()));
    this.setUnsignedTxHex(_GenUtils.default.reconcile(this.getUnsignedTxHex(), txSet.getUnsignedTxHex()));
    this.setSignedTxHex(_GenUtils.default.reconcile(this.getSignedTxHex(), txSet.getSignedTxHex()));

    // merge txs
    if (txSet.getTxs() !== undefined) {
      for (let tx of txSet.getTxs()) {
        tx.setTxSet(this);
        _MoneroUtils.default.mergeTx(this.getTxs(), tx);
      }
    }

    return this;
  }

  toString(indent = 0) {
    let str = "";
    str += _GenUtils.default.kvLine("Multisig tx hex: ", this.getMultisigTxHex(), indent);
    str += _GenUtils.default.kvLine("Unsigned tx hex: ", this.getUnsignedTxHex(), indent);
    str += _GenUtils.default.kvLine("Signed tx hex: ", this.getSignedTxHex(), indent);
    if (this.getTxs() !== undefined) {
      str += _GenUtils.default.kvLine("Txs", "", indent);
      for (let tx of this.getTxs()) {
        str += tx.toString(indent + 1) + "\n";
      }
    }
    return str;
  }
}exports.default = MoneroTxSet;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXNzZXJ0IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfR2VuVXRpbHMiLCJfTW9uZXJvVHhXYWxsZXQiLCJfTW9uZXJvVXRpbHMiLCJNb25lcm9UeFNldCIsImNvbnN0cnVjdG9yIiwidHhTZXQiLCJPYmplY3QiLCJhc3NpZ24iLCJ0eHMiLCJpIiwibGVuZ3RoIiwiTW9uZXJvVHhXYWxsZXQiLCJzZXRUeFNldCIsInRvSnNvbiIsImpzb24iLCJnZXRUeHMiLCJ1bmRlZmluZWQiLCJ0eCIsInB1c2giLCJzZXRUeHMiLCJnZXRNdWx0aXNpZ1R4SGV4IiwibXVsdGlzaWdUeEhleCIsInNldE11bHRpc2lnVHhIZXgiLCJnZXRVbnNpZ25lZFR4SGV4IiwidW5zaWduZWRUeEhleCIsInNldFVuc2lnbmVkVHhIZXgiLCJnZXRTaWduZWRUeEhleCIsInNpZ25lZFR4SGV4Iiwic2V0U2lnbmVkVHhIZXgiLCJtZXJnZSIsImFzc2VydCIsIkdlblV0aWxzIiwicmVjb25jaWxlIiwiTW9uZXJvVXRpbHMiLCJtZXJnZVR4IiwidG9TdHJpbmciLCJpbmRlbnQiLCJzdHIiLCJrdkxpbmUiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3RzL3dhbGxldC9tb2RlbC9Nb25lcm9UeFNldC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXNzZXJ0IGZyb20gXCJhc3NlcnRcIjtcbmltcG9ydCBHZW5VdGlscyBmcm9tIFwiLi4vLi4vY29tbW9uL0dlblV0aWxzXCI7XG5pbXBvcnQgTW9uZXJvVHhXYWxsZXQgZnJvbSBcIi4vTW9uZXJvVHhXYWxsZXRcIjtcbmltcG9ydCBNb25lcm9VdGlscyBmcm9tIFwiLi4vLi4vY29tbW9uL01vbmVyb1V0aWxzXCI7XG5cbi8qKlxuICogR3JvdXBzIHRyYW5zYWN0aW9ucyB3aG8gc2hhcmUgY29tbW9uIGhleCBkYXRhIHdoaWNoIGlzIG5lZWRlZCBpbiBvcmRlciB0b1xuICogc2lnbiBhbmQgc3VibWl0IHRoZSB0cmFuc2FjdGlvbnMuXG4gKiBcbiAqIEZvciBleGFtcGxlLCBtdWx0aXNpZyB0cmFuc2FjdGlvbnMgY3JlYXRlZCBmcm9tIGNyZWF0ZVR4cygpIHNoYXJlIGEgY29tbW9uXG4gKiBoZXggc3RyaW5nIHdoaWNoIGlzIG5lZWRlZCBpbiBvcmRlciB0byBzaWduIGFuZCBzdWJtaXQgdGhlIG11bHRpc2lnXG4gKiB0cmFuc2FjdGlvbnMuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vbmVyb1R4U2V0IHtcblxuICB0eHM6IE1vbmVyb1R4V2FsbGV0W107XG4gIG11bHRpc2lnVHhIZXg6IHN0cmluZztcbiAgdW5zaWduZWRUeEhleDogc3RyaW5nO1xuICBzaWduZWRUeEhleDogc3RyaW5nO1xuICBcbiAgY29uc3RydWN0b3IodHhTZXQ/OiBQYXJ0aWFsPE1vbmVyb1R4U2V0Pikge1xuICAgIE9iamVjdC5hc3NpZ24odGhpcywgdHhTZXQpO1xuICAgIFxuICAgIC8vIGNvcHkgdHhzXG4gICAgaWYgKHRoaXMudHhzKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudHhzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMudHhzW2ldID0gbmV3IE1vbmVyb1R4V2FsbGV0KHRoaXMudHhzW2ldKTtcbiAgICAgICAgdGhpcy50eHNbaV0uc2V0VHhTZXQodGhpcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICB0b0pzb24oKSB7XG4gICAgbGV0IGpzb24gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzKTsgLy8gY29weSBzdGF0ZVxuICAgIGlmICh0aGlzLmdldFR4cygpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGpzb24udHhzID0gW107XG4gICAgICBmb3IgKGxldCB0eCBvZiB0aGlzLmdldFR4cygpKSBqc29uLnR4cy5wdXNoKHR4LnRvSnNvbigpKTtcbiAgICB9XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICBnZXRUeHMoKSB7XG4gICAgcmV0dXJuIHRoaXMudHhzO1xuICB9XG5cbiAgc2V0VHhzKHR4cykge1xuICAgIHRoaXMudHhzID0gdHhzO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIFxuICBnZXRNdWx0aXNpZ1R4SGV4KCkge1xuICAgIHJldHVybiB0aGlzLm11bHRpc2lnVHhIZXg7XG4gIH1cbiAgXG4gIHNldE11bHRpc2lnVHhIZXgobXVsdGlzaWdUeEhleCkge1xuICAgIHRoaXMubXVsdGlzaWdUeEhleCA9IG11bHRpc2lnVHhIZXg7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgXG4gIGdldFVuc2lnbmVkVHhIZXgoKSB7XG4gICAgcmV0dXJuIHRoaXMudW5zaWduZWRUeEhleDtcbiAgfVxuICBcbiAgc2V0VW5zaWduZWRUeEhleCh1bnNpZ25lZFR4SGV4KSB7XG4gICAgdGhpcy51bnNpZ25lZFR4SGV4ID0gdW5zaWduZWRUeEhleDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBcbiAgZ2V0U2lnbmVkVHhIZXgoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2lnbmVkVHhIZXg7XG4gIH1cbiAgXG4gIHNldFNpZ25lZFR4SGV4KHNpZ25lZFR4SGV4KSB7XG4gICAgdGhpcy5zaWduZWRUeEhleCA9IHNpZ25lZFR4SGV4O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIFxuICBtZXJnZSh0eFNldCkge1xuICAgIGFzc2VydCh0eFNldCBpbnN0YW5jZW9mIE1vbmVyb1R4U2V0KTtcbiAgICBpZiAodGhpcyA9PT0gdHhTZXQpIHJldHVybiB0aGlzO1xuICAgIFxuICAgIC8vIG1lcmdlIHNldHNcbiAgICB0aGlzLnNldE11bHRpc2lnVHhIZXgoR2VuVXRpbHMucmVjb25jaWxlKHRoaXMuZ2V0TXVsdGlzaWdUeEhleCgpLCB0eFNldC5nZXRNdWx0aXNpZ1R4SGV4KCkpKTtcbiAgICB0aGlzLnNldFVuc2lnbmVkVHhIZXgoR2VuVXRpbHMucmVjb25jaWxlKHRoaXMuZ2V0VW5zaWduZWRUeEhleCgpLCB0eFNldC5nZXRVbnNpZ25lZFR4SGV4KCkpKTtcbiAgICB0aGlzLnNldFNpZ25lZFR4SGV4KEdlblV0aWxzLnJlY29uY2lsZSh0aGlzLmdldFNpZ25lZFR4SGV4KCksIHR4U2V0LmdldFNpZ25lZFR4SGV4KCkpKTtcbiAgICBcbiAgICAvLyBtZXJnZSB0eHNcbiAgICBpZiAodHhTZXQuZ2V0VHhzKCkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZm9yIChsZXQgdHggb2YgdHhTZXQuZ2V0VHhzKCkpIHtcbiAgICAgICAgdHguc2V0VHhTZXQodGhpcyk7XG4gICAgICAgIE1vbmVyb1V0aWxzLm1lcmdlVHgodGhpcy5nZXRUeHMoKSwgdHgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIFxuICB0b1N0cmluZyhpbmRlbnQgPSAwKSB7XG4gICAgbGV0IHN0ciA9IFwiXCI7XG4gICAgc3RyICs9IEdlblV0aWxzLmt2TGluZShcIk11bHRpc2lnIHR4IGhleDogXCIsIHRoaXMuZ2V0TXVsdGlzaWdUeEhleCgpLCBpbmRlbnQpO1xuICAgIHN0ciArPSBHZW5VdGlscy5rdkxpbmUoXCJVbnNpZ25lZCB0eCBoZXg6IFwiLCB0aGlzLmdldFVuc2lnbmVkVHhIZXgoKSwgaW5kZW50KTtcbiAgICBzdHIgKz0gR2VuVXRpbHMua3ZMaW5lKFwiU2lnbmVkIHR4IGhleDogXCIsIHRoaXMuZ2V0U2lnbmVkVHhIZXgoKSwgaW5kZW50KTtcbiAgICBpZiAodGhpcy5nZXRUeHMoKSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzdHIgKz0gR2VuVXRpbHMua3ZMaW5lKFwiVHhzXCIsIFwiXCIsIGluZGVudCk7XG4gICAgICBmb3IgKGxldCB0eCBvZiB0aGlzLmdldFR4cygpKSB7XG4gICAgICAgIHN0ciArPSB0eC50b1N0cmluZyhpbmRlbnQgKyAxKSArIFwiXFxuXCI7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG4gIH1cbn0iXSwibWFwcGluZ3MiOiJ5TEFBQSxJQUFBQSxPQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxlQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxZQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNlLE1BQU1JLFdBQVcsQ0FBQzs7Ozs7OztFQU8vQkMsV0FBV0EsQ0FBQ0MsS0FBNEIsRUFBRTtJQUN4Q0MsTUFBTSxDQUFDQyxNQUFNLENBQUMsSUFBSSxFQUFFRixLQUFLLENBQUM7O0lBRTFCO0lBQ0EsSUFBSSxJQUFJLENBQUNHLEdBQUcsRUFBRTtNQUNaLEtBQUssSUFBSUMsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHLElBQUksQ0FBQ0QsR0FBRyxDQUFDRSxNQUFNLEVBQUVELENBQUMsRUFBRSxFQUFFO1FBQ3hDLElBQUksQ0FBQ0QsR0FBRyxDQUFDQyxDQUFDLENBQUMsR0FBRyxJQUFJRSx1QkFBYyxDQUFDLElBQUksQ0FBQ0gsR0FBRyxDQUFDQyxDQUFDLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUNELEdBQUcsQ0FBQ0MsQ0FBQyxDQUFDLENBQUNHLFFBQVEsQ0FBQyxJQUFJLENBQUM7TUFDNUI7SUFDRjtFQUNGOztFQUVBQyxNQUFNQSxDQUFBLEVBQUc7SUFDUCxJQUFJQyxJQUFJLEdBQUdSLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDcEMsSUFBSSxJQUFJLENBQUNRLE1BQU0sQ0FBQyxDQUFDLEtBQUtDLFNBQVMsRUFBRTtNQUMvQkYsSUFBSSxDQUFDTixHQUFHLEdBQUcsRUFBRTtNQUNiLEtBQUssSUFBSVMsRUFBRSxJQUFJLElBQUksQ0FBQ0YsTUFBTSxDQUFDLENBQUMsRUFBRUQsSUFBSSxDQUFDTixHQUFHLENBQUNVLElBQUksQ0FBQ0QsRUFBRSxDQUFDSixNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzFEO0lBQ0EsT0FBT0MsSUFBSTtFQUNiOztFQUVBQyxNQUFNQSxDQUFBLEVBQUc7SUFDUCxPQUFPLElBQUksQ0FBQ1AsR0FBRztFQUNqQjs7RUFFQVcsTUFBTUEsQ0FBQ1gsR0FBRyxFQUFFO0lBQ1YsSUFBSSxDQUFDQSxHQUFHLEdBQUdBLEdBQUc7SUFDZCxPQUFPLElBQUk7RUFDYjs7RUFFQVksZ0JBQWdCQSxDQUFBLEVBQUc7SUFDakIsT0FBTyxJQUFJLENBQUNDLGFBQWE7RUFDM0I7O0VBRUFDLGdCQUFnQkEsQ0FBQ0QsYUFBYSxFQUFFO0lBQzlCLElBQUksQ0FBQ0EsYUFBYSxHQUFHQSxhQUFhO0lBQ2xDLE9BQU8sSUFBSTtFQUNiOztFQUVBRSxnQkFBZ0JBLENBQUEsRUFBRztJQUNqQixPQUFPLElBQUksQ0FBQ0MsYUFBYTtFQUMzQjs7RUFFQUMsZ0JBQWdCQSxDQUFDRCxhQUFhLEVBQUU7SUFDOUIsSUFBSSxDQUFDQSxhQUFhLEdBQUdBLGFBQWE7SUFDbEMsT0FBTyxJQUFJO0VBQ2I7O0VBRUFFLGNBQWNBLENBQUEsRUFBRztJQUNmLE9BQU8sSUFBSSxDQUFDQyxXQUFXO0VBQ3pCOztFQUVBQyxjQUFjQSxDQUFDRCxXQUFXLEVBQUU7SUFDMUIsSUFBSSxDQUFDQSxXQUFXLEdBQUdBLFdBQVc7SUFDOUIsT0FBTyxJQUFJO0VBQ2I7O0VBRUFFLEtBQUtBLENBQUN4QixLQUFLLEVBQUU7SUFDWCxJQUFBeUIsZUFBTSxFQUFDekIsS0FBSyxZQUFZRixXQUFXLENBQUM7SUFDcEMsSUFBSSxJQUFJLEtBQUtFLEtBQUssRUFBRSxPQUFPLElBQUk7O0lBRS9CO0lBQ0EsSUFBSSxDQUFDaUIsZ0JBQWdCLENBQUNTLGlCQUFRLENBQUNDLFNBQVMsQ0FBQyxJQUFJLENBQUNaLGdCQUFnQixDQUFDLENBQUMsRUFBRWYsS0FBSyxDQUFDZSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RixJQUFJLENBQUNLLGdCQUFnQixDQUFDTSxpQkFBUSxDQUFDQyxTQUFTLENBQUMsSUFBSSxDQUFDVCxnQkFBZ0IsQ0FBQyxDQUFDLEVBQUVsQixLQUFLLENBQUNrQixnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RixJQUFJLENBQUNLLGNBQWMsQ0FBQ0csaUJBQVEsQ0FBQ0MsU0FBUyxDQUFDLElBQUksQ0FBQ04sY0FBYyxDQUFDLENBQUMsRUFBRXJCLEtBQUssQ0FBQ3FCLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7SUFFdEY7SUFDQSxJQUFJckIsS0FBSyxDQUFDVSxNQUFNLENBQUMsQ0FBQyxLQUFLQyxTQUFTLEVBQUU7TUFDaEMsS0FBSyxJQUFJQyxFQUFFLElBQUlaLEtBQUssQ0FBQ1UsTUFBTSxDQUFDLENBQUMsRUFBRTtRQUM3QkUsRUFBRSxDQUFDTCxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ2pCcUIsb0JBQVcsQ0FBQ0MsT0FBTyxDQUFDLElBQUksQ0FBQ25CLE1BQU0sQ0FBQyxDQUFDLEVBQUVFLEVBQUUsQ0FBQztNQUN4QztJQUNGOztJQUVBLE9BQU8sSUFBSTtFQUNiOztFQUVBa0IsUUFBUUEsQ0FBQ0MsTUFBTSxHQUFHLENBQUMsRUFBRTtJQUNuQixJQUFJQyxHQUFHLEdBQUcsRUFBRTtJQUNaQSxHQUFHLElBQUlOLGlCQUFRLENBQUNPLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUNsQixnQkFBZ0IsQ0FBQyxDQUFDLEVBQUVnQixNQUFNLENBQUM7SUFDNUVDLEdBQUcsSUFBSU4saUJBQVEsQ0FBQ08sTUFBTSxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQ2YsZ0JBQWdCLENBQUMsQ0FBQyxFQUFFYSxNQUFNLENBQUM7SUFDNUVDLEdBQUcsSUFBSU4saUJBQVEsQ0FBQ08sTUFBTSxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQ1osY0FBYyxDQUFDLENBQUMsRUFBRVUsTUFBTSxDQUFDO0lBQ3hFLElBQUksSUFBSSxDQUFDckIsTUFBTSxDQUFDLENBQUMsS0FBS0MsU0FBUyxFQUFFO01BQy9CcUIsR0FBRyxJQUFJTixpQkFBUSxDQUFDTyxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRUYsTUFBTSxDQUFDO01BQ3pDLEtBQUssSUFBSW5CLEVBQUUsSUFBSSxJQUFJLENBQUNGLE1BQU0sQ0FBQyxDQUFDLEVBQUU7UUFDNUJzQixHQUFHLElBQUlwQixFQUFFLENBQUNrQixRQUFRLENBQUNDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJO01BQ3ZDO0lBQ0Y7SUFDQSxPQUFPQyxHQUFHO0VBQ1o7QUFDRixDQUFDRSxPQUFBLENBQUFDLE9BQUEsR0FBQXJDLFdBQUEifQ==